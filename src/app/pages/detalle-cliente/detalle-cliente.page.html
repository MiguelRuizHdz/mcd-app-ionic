<ion-header mode="ios">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/clientes" text="Clientes"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalle</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="editarCliente()" color="primary">
        Editar
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <div class="user-profile-header ion-text-center ion-padding">
    <div class="photo-container">
      <img [src]="cliente?.foto ? cliente?.foto : './assets/avatars/FotoCamara.png'" class="profile-photo">
    </div>
    <h1 class="ion-no-margin">{{ cliente?.nombre }} {{ cliente?.apellido }}</h1>
    <p class="ion-no-margin color-medium">{{ cliente?.correo }}</p>

    <!-- Acciones rápidas -->
    <div class="quick-actions ion-margin-top">
      <ion-button fill="clear" (click)="llamar()" [disabled]="!cliente?.telefono">
        <ion-icon slot="icon-only" name="call"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="mensaje()" [disabled]="!cliente?.telefono">
        <ion-icon slot="icon-only" name="chatbubble"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="correo()" [disabled]="!cliente?.correo">
        <ion-icon slot="icon-only" name="mail"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="verMapa()" [disabled]="!cliente?.direccion">
        <ion-icon slot="icon-only" name="map"></ion-icon>
      </ion-button>
    </div>
  </div>

  <ion-list mode="ios" class="inset-list">
    <ion-list-header>
      <ion-label>Resumen de Adeudos</ion-label>
    </ion-list-header>

    <ion-item lines="none" class="total-debt-item">
      <ion-label>
        <h2>Total Pendiente</h2>
        <h3 class="debt-amount">{{ totalAdeudo | currency }}</h3>
      </ion-label>
      <ion-button slot="end" size="small" (click)="nuevoAdeudo()">
        <ion-icon name="add" slot="start"></ion-icon>
        Nuevo
      </ion-button>
    </ion-item>

    <ion-item-divider mode="ios">
      <ion-label>Adeudos actuales</ion-label>
      <ion-button slot="end" fill="clear" size="small" (click)="toggleModoSeleccion()">
        {{ modoSeleccion ? 'Cancelar' : 'Seleccionar' }}
      </ion-button>
    </ion-item-divider>

    <ion-item *ngFor="let adeudo of adeudos" (click)="toggleSeleccion(adeudo.id)" button [detail]="!modoSeleccion"
      lines="full">
      <ion-checkbox slot="start" *ngIf="modoSeleccion"
        [checked]="adeudosSeleccionados.includes(adeudo.id)"></ion-checkbox>
      <ion-label>
        <h2>{{ adeudo.concepto }}</h2>
        <p>Vence: {{ adeudo.fechaPagarAntesDe | date:'dd/MM/yyyy' }}</p>
      </ion-label>
      <ion-note slot="end" [color]="adeudo.aDeber === 0 ? 'success' : 'danger'">
        {{ adeudo.aDeber | currency }}
      </ion-note>
    </ion-item>

    <div class="ion-padding" *ngIf="modoSeleccion && adeudosSeleccionados.length > 0">
      <ion-button expand="block" shape="round" color="success" (click)="pagarSeleccionados()">
        Pagar seleccionados ({{ adeudosSeleccionados.length }})
      </ion-button>
    </div>

    <ion-item *ngIf="adeudos.length === 0" lines="none" class="ion-text-center">
      <ion-label color="medium">No hay adeudos registrados</ion-label>
    </ion-item>
  </ion-list>

  <ion-list mode="ios" class="inset-list ion-margin-top">
    <ion-list-header>
      <ion-label>Información del Contácto</ion-label>
    </ion-list-header>

    <ion-item lines="full">
      <ion-label>
        <p>Teléfono</p>
        <h2>{{ cliente?.telefono || 'No registrado' }}</h2>
      </ion-label>
    </ion-item>

    <ion-item lines="full" (click)="verMapa()" [button]="!!cliente?.direccion">
      <ion-label>
        <p>Dirección</p>
        <h2>{{ cliente?.direccion || 'No registrada' }}</h2>
      </ion-label>
      <ion-icon slot="end" name="locate-outline" *ngIf="cliente?.direccion"></ion-icon>
    </ion-item>

    <ion-item lines="none">
      <ion-label>
        <p>Email</p>
        <h2>{{ cliente?.correo || 'No registrado' }}</h2>
      </ion-label>
    </ion-item>
  </ion-list>

</ion-content>